<div class="user-management-tab">
    <div class="user-management-section">
        <div class="header-row">
            <h2 class="title">User Management</h2>
        </div>

        <div class="filter-row">
            <div class="search-box">
                <span class="search-icon">üîç</span>
                <input type="text" [(ngModel)]="searchTerm" (input)="applySearch()" placeholder="Search users...">
            </div>

            <div class="filter-item">
                <select [(ngModel)]="roleFilter" (change)="applySearch()">
                    <option value="">All Roles</option>
                    <option *ngFor="let role of roles" [value]="role">{{ role }}</option>
                </select>
            </div>

            <div class="filter-item">
                <select [(ngModel)]="deptFilter" (change)="applySearch()">
                    <option value="">All Departments</option>
                    <option *ngFor="let dept of departments" [value]="dept">{{ dept }}</option>
                </select>
            </div>
        </div>
    </div>

    <div class="table-container">
        <table class="user-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Role</th>
                    <th>Department</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let user of filteredUsers">
                    <td>{{user.fullName}}</td>
                    <td>{{user.email}}</td>
                    <td>
                        <span class="badge-role" [ngClass]="user.role.toLowerCase()">
                            {{user.role}}
                        </span>
                    </td>
                    <td>{{user.department}}</td>
                    <td>
                        <span class="badge-status"
                            [ngClass]="getDisplayStatus(user) === 'Active' ? 'status-active' : 'status-inactive'">
                            {{getDisplayStatus(user)}}
                        </span>
                    </td>
                    <td class="actions">
                        <button class="action-btn edit-btn" (click)="openEditModal(user)" title="Edit User">
                            ‚úèÔ∏è
                        </button>

                        <button class="action-btn delete-btn" (click)="deleteUser(user.email)" title="Delete User">
                            üóëÔ∏è
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Edit User Modal -->
<div class="modal-overlay" *ngIf="showEditModal" (click)="closeEditModal()">
    <div class="modal-container" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h3>Edit User: {{ selectedUser?.fullName }}</h3>
            <button class="close-icon" (click)="closeEditModal()">&times;</button>
        </div>

        <form (ngSubmit)="saveUserChanges()">
            <div class="form-grid">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" name="fullName" [(ngModel)]="selectedUser!.fullName" required>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" name="email" [(ngModel)]="selectedUser!.email" disabled>
                </div>
                <div class="form-group">
                    <label>Role</label>
                    <select name="role" [(ngModel)]="selectedUser!.role" (change)="onEditRoleChange()">
                        <option value="Employee">Employee</option>
                        <option value="Manager">Manager</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Department</label>
                    <select name="department" [(ngModel)]="selectedUser!.department">
                        <option *ngFor="let dept of departments" [value]="dept">{{ dept }}</option>
                    </select>
                </div>
            </div>

            <!-- Manager Assignment Section -->
            <div class="manager-assignment" *ngIf="selectedUser && selectedUser.role === 'Employee'">
                <hr>
                <h4>Manager Assignment</h4>
                <div class="form-group">
                    <label>Assign Manager</label>
                    <select name="manager" [(ngModel)]="selectedUser.managerId">
                        <option value="">-- No Manager --</option>
                        <option *ngFor="let manager of availableManagers" [value]="manager.id">
                            {{ manager.fullName }}
                        </option>
                    </select>
                </div>
            </div>

            <!-- Employee Assignment Section -->
            <div class="employee-assignment" *ngIf="selectedUser && selectedUser.role === 'Manager'">
                <hr>
                <h4>Assign Employees</h4>
                <div class="employee-list">
                    <div class="checkbox-group" *ngFor="let employee of availableEmployees">
                        <input type="checkbox" 
                               [id]="'emp-' + employee.id" 
                               [checked]="isEmployeeAssigned(employee.id)"
                               (change)="toggleEmployeeAssignment(employee.id)">
                        <label [for]="'emp-' + employee.id">
                            {{ employee.fullName }}
                        </label>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn-cancel" (click)="closeEditModal()">Cancel</button>
                <button type="submit" class="btn-save">Save Changes</button>
            </div>
        </form>
    </div>
</div>