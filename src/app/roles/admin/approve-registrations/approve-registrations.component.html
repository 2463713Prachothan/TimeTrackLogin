<div class="registrations-container">
  <h2>Registration Requests</h2>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>

  <!-- Tabs -->
  <div class="tabs">
    <button [class.active]="activeTab === 'pending'" (click)="setActiveTab('pending')">
      Pending <span class="badge pending">{{ getPendingCount() }}</span>
    </button>
    <button [class.active]="activeTab === 'approved'" (click)="setActiveTab('approved')">
      Approved <span class="badge approved">{{ getApprovedCount() }}</span>
    </button>
    <button [class.active]="activeTab === 'rejected'" (click)="setActiveTab('rejected')">
      Rejected <span class="badge rejected">{{ getRejectedCount() }}</span>
    </button>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading">Loading registrations...</div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && filteredRegistrations.length === 0" class="empty-state">
    No {{ activeTab }} registrations found.
  </div>

  <!-- Table -->
  <table *ngIf="!isLoading && filteredRegistrations.length > 0" class="registrations-table">
    <thead>
      <tr>
        <th>Name</th>
        <th>Email</th>
        <th>Role</th>
        <th>Department</th>
        <th>Applied Date</th>
        <th *ngIf="activeTab !== 'pending'">Processed Date</th>
        <th *ngIf="activeTab === 'rejected'">Rejection Reason</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let reg of filteredRegistrations">
        <td>{{ reg.name }}</td>
        <td>{{ reg.email }}</td>
        <td><span class="role-badge" [class.manager]="reg.role === 'Manager'">{{ reg.role }}</span></td>
        <td>{{ reg.department }}</td>
        <td>{{ formatDate(reg.appliedDate) }}</td>
        <td *ngIf="activeTab !== 'pending'">{{ formatDate(reg.processedDate) }}</td>
        <td *ngIf="activeTab === 'rejected'" class="rejection-reason">{{ reg.rejectionReason || '-' }}</td>
        <td class="actions">
          <ng-container *ngIf="activeTab === 'pending'">
            <button class="btn-approve" (click)="approveRegistration(reg)">âœ“ Approve</button>
            <button class="btn-reject" (click)="openRejectModal(reg)">âœ— Reject</button>
          </ng-container>
          <ng-container *ngIf="activeTab !== 'pending'">
            <button class="btn-delete" (click)="deleteRegistration(reg)">ðŸ—‘ Delete</button>
          </ng-container>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Reject Modal -->
  <div *ngIf="showRejectModal" class="modal-overlay" (click)="closeRejectModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <h3>Reject Registration</h3>
      <p>Rejecting: <strong>{{ selectedRegistration?.name }}</strong></p>
      <label>Rejection Reason (Optional):</label>
      <textarea [(ngModel)]="rejectionReason" placeholder="Enter reason..." rows="3"></textarea>
      <div class="modal-actions">
        <button class="btn-cancel" (click)="closeRejectModal()">Cancel</button>
        <button class="btn-confirm-reject" (click)="confirmReject()">Confirm Reject</button>
      </div>
    </div>
  </div>
</div>