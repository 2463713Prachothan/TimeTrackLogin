<div class="container-fluid p-0">
  <!-- Tab Navigation -->
  <div class="tabs-navigation mb-4">
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'Manage Tasks'"
      (click)="activeTab = 'Manage Tasks'">
      <i class="fas fa-tasks"></i> Manage Tasks
    </button>
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'Pending Approval'"
      (click)="activeTab = 'Pending Approval'; loadPendingApprovalTasks()">
      <i class="fas fa-clock"></i> Pending Approval
    </button>
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'Overdue Tasks'"
      (click)="activeTab = 'Overdue Tasks'; loadOverdueTasks()">
      <i class="fas fa-exclamation-triangle"></i> Overdue Tasks
    </button>
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'Approved'"
      (click)="activeTab = 'Approved'">
      <i class="fas fa-check-circle"></i> Approved
    </button>
  </div>

  <!-- Stats Cards - Show on all tabs -->
  <div class="row g-3 mb-4">
    <div class="col-md-3">
      <div class="card border-0 shadow-sm p-3 d-flex flex-row justify-content-between align-items-center">
        <div>
          <small class="text-muted d-block">Pending Tasks</small>
          <h5 class="fw-bold mb-0">{{ getCount('Pending') }}</h5>
        </div>
        <div class="icon-box border rounded p-2 text-muted">
          <i class="bi bi-circle"></i>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card border-0 shadow-sm p-3 d-flex flex-row justify-content-between align-items-center">
        <div>
          <small class="text-muted d-block">In Progress</small>
          <h5 class="fw-bold mb-0">{{ getCount('InProgress') }}</h5>
        </div>
        <div class="icon-box icon-blue rounded p-2">
          <i class="bi bi-clock"></i>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card border-0 shadow-sm p-3 d-flex flex-row justify-content-between align-items-center">
        <div>
          <small class="text-muted d-block">Completed</small>
          <h5 class="fw-bold mb-0">{{ getCount('Completed') }}</h5>
        </div>
        <div class="icon-box icon-green rounded p-2">
          <i class="bi bi-check-circle"></i>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card border-0 shadow-sm p-3 d-flex flex-row justify-content-between align-items-center">
        <div>
          <small class="text-muted d-block">Approved</small>
          <h5 class="fw-bold mb-0">{{ getCount('Approved') }}</h5>
        </div>
        <div class="icon-box icon-green rounded p-2">
          <i class="bi bi-check-circle-fill"></i>
        </div>
      </div>
    </div>
  </div>

  <!-- Manage Tasks Tab -->
  @if (activeTab === 'Manage Tasks') {
  <div class="card border-0 shadow-sm p-4">
    <!-- Compact Horizontal Filter Bar -->
    <div class="filter-bar-horizontal">
      <select class="form-select filter-select" [(ngModel)]="selectedStatusFilter">
        <option value="All">All Tasks</option>
        <option value="Pending">Pending</option>
        <option value="InProgress">In Progress</option>
        <option value="Completed">Completed</option>
        <option value="Approved">Approved</option>
      </select>
      
      <select class="form-select filter-select" [(ngModel)]="selectedMemberFilter">
        <option value="All">All Team Members</option>
        <option *ngFor="let member of teamMembers" [value]="member.userId">
          {{ member.name }}
        </option>
      </select>
      
      <button class="btn btn-outline-secondary filter-btn" (click)="resetFilters()">
        <i class="bi bi-arrow-clockwise me-1"></i> Reset Filters
      </button>
      
      <button class="btn btn-primary filter-btn" (click)="showModal = true">
        <i class="bi bi-plus-lg me-1"></i> Create Task
      </button>
    </div>

    <div class="list-group list-group-flush">
      @for (task of filteredTasks; track task.id) {
      <div class="card border mb-3 p-3 shadow-sm task-item">
        <div class="d-flex justify-content-between align-items-start">
          <div class="d-flex flex-grow-1">
            <div class="me-3 mt-1">
              <i class="bi" [ngClass]="{
                'bi-check-circle-fill text-success': task.status === 'Completed',
                'bi-play-circle-fill text-primary': task.status === 'In Progress',
                'bi-dash-circle text-muted': task.status === 'Pending'
              }"></i>
            </div>
            <div class="flex-grow-1">
              <div class="d-flex align-items-center gap-2 mb-1">
                <h6 class="fw-bold mb-0">{{ task.title }}</h6>
                <span class="task-id-badge">#{{ task.taskId }}</span>
              </div>
              
              <div class="mb-2">
                <span class="badge rounded-pill me-2" [ngClass]="{
                  'bg-success text-white': task.status === 'Approved',
                  'bg-warning text-dark': task.status === 'Completed',
                  'bg-primary-subtle text-primary': task.status === 'InProgress' || task.status === 'In Progress',
                  'bg-light text-dark border': task.status === 'Pending'
                }">{{ task.status }}</span>
                
                <span class="badge rounded-pill" [ngClass]="getPriorityClass(task.priority)">
                  {{ task.priority }} Priority
                </span>

                @if (task.isOverdue) {
                <span class="badge rounded-pill bg-danger text-white">
                  <i class="bi bi-exclamation-triangle"></i> OVERDUE
                </span>
                }
                @if (task.daysUntilDue !== undefined && task.daysUntilDue <= 3 && task.daysUntilDue > 0 && !task.isOverdue) {
                <span class="badge rounded-pill bg-warning text-dark">
                  <i class="bi bi-clock"></i> Due in {{ task.daysUntilDue }} days
                </span>
                }
              </div>
              
              <p class="small text-muted mb-1">{{ task.description }}</p>
              <small class="text-muted">
                <strong>Assigned to:</strong>
                <span class="badge bg-info-subtle text-info me-1">{{ task.assignedToUserName }}</span>
                • Est. {{ task.estimatedHours }} hours
                @if (task.actualHours) {
                • Actual: {{ task.actualHours }} hours
                }
                @if (task.dueDate) {
                • Due: {{ task.dueDate | date: 'MMM dd, yyyy' }}
                }
              </small>

              <!-- Progress Bar for Estimated vs Actual Hours -->
              @if (task.estimatedHours && task.actualHours !== undefined) {
              <div class="mt-2">
                <div class="d-flex justify-content-between align-items-center mb-1">
                  <small class="text-muted">Progress: {{ task.actualHours }} / {{ task.estimatedHours }} hours</small>
                  <small class="text-muted">{{ (task.actualHours / task.estimatedHours * 100) | number:'1.0-0' }}%</small>
                </div>
                <div class="progress" style="height: 8px;">
                  <div class="progress-bar" 
                    [ngClass]="{
                      'bg-danger': (task.actualHours / task.estimatedHours) > 1.2,
                      'bg-warning': (task.actualHours / task.estimatedHours) > 1 && (task.actualHours / task.estimatedHours) <= 1.2,
                      'bg-success': (task.actualHours / task.estimatedHours) <= 1
                    }"
                    [style.width.%]="(task.actualHours / task.estimatedHours * 100 > 100 ? 100 : task.actualHours / task.estimatedHours * 100)">
                  </div>
                </div>
              </div>
              }
            </div>
          </div>
          <div class="d-flex gap-2">
            <!-- Approve Button (only for Completed tasks) -->
            @if (task.status === 'Completed' && task.canApprove !== false) {
            <button class="btn btn-success btn-sm" (click)="approveTask(task)" title="Approve task completion">
              <i class="bi bi-check-circle"></i> Approve
            </button>
            }
            <!-- Reject Button (only for Completed tasks) -->
            @if (task.status === 'Completed') {
            <button class="btn btn-danger btn-sm" (click)="rejectTask(task)" title="Reject and send back to In Progress">
              <i class="bi bi-x-circle"></i> Reject
            </button>
            }
            <button class="btn btn-outline-primary btn-sm border-0" (click)="openEditModal(task)">
              <i class="bi bi-pencil"></i>
            </button>
            <button class="btn btn-outline-danger btn-sm border-0" (click)="onDeleteTask(task.taskId)">
              <i class="bi bi-trash3"></i>
            </button>
          </div>
        </div>
      </div>
      }
      @empty {
      <div class="text-center py-5">
        <i class="bi bi-inbox" style="font-size: 3rem;"></i>
        <p class="mt-3">No tasks found matching the selected filters.</p>
        <button class="btn btn-outline-primary mt-2" (click)="resetFilters()">
          <i class="bi bi-arrow-clockwise me-1"></i> Clear Filters
        </button>
      </div>
      }
    </div>
  </div>
  }

  <!-- Pending Approval Tab -->
  @if (activeTab === 'Pending Approval') {
  <div class="card border-0 shadow-sm p-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h5 class="fw-bold mb-0"><i class="fas fa-clock text-warning"></i> Tasks Pending Approval</h5>
      <button class="btn btn-sm btn-outline-primary" (click)="loadPendingApprovalTasks()">
        <i class="bi bi-arrow-clockwise"></i> Refresh
      </button>
    </div>

    <div class="list-group list-group-flush">
      @for (task of pendingApprovalTasks; track task.taskId) {
      @if (task.status === 'Completed') {
      <div class="card border mb-3 p-3 shadow-sm" style="border-left: 4px solid #ffc107 !important;">
        <div class="d-flex justify-content-between align-items-start">
          <div class="flex-grow-1">
            <div class="d-flex align-items-center gap-2 mb-2">
              <i class="bi bi-clock-fill text-warning"></i>
              <h6 class="fw-bold mb-0">{{ task.title }}</h6>
              <span class="task-id-badge">Task #{{ task.taskId }}</span>
            </div>
            <p class="small text-muted mb-2">{{ task.description }}</p>
            <div class="d-flex gap-2 mb-2">
              <span class="badge bg-info-subtle text-info">{{ task.assignedToUserName }}</span>
              <span class="badge bg-warning text-dark">Awaiting Approval</span>
              @if (task.completedDate) {
              <small class="text-muted">Completed: {{ task.completedDate | date: 'MMM dd, yyyy HH:mm' }}</small>
              }
            </div>
            @if (task.estimatedHours && task.actualHours !== undefined) {
            <small class="text-muted">Est. {{ task.estimatedHours }}h | Actual: {{ task.actualHours }}h</small>
            }
            @if (getTaskSubmissionComments(task.taskId)) {
            <div class="alert alert-info mt-2 mb-0" style="font-size: 0.875rem;">
              <strong><i class="bi bi-chat-left-text"></i> Completion Notes:</strong>
              <p class="mb-0 mt-1">{{ getTaskSubmissionComments(task.taskId) }}</p>
            </div>
            }
          </div>
          <div class="d-flex gap-2">
            <button class="btn btn-success btn-sm" (click)="approveTask(task)">
              <i class="bi bi-check-circle"></i> Approve
            </button>
            <button class="btn btn-danger btn-sm" (click)="rejectTask(task)">
              <i class="bi bi-x-circle"></i> Reject
            </button>
          </div>
        </div>
      </div>
      }
      }
      @empty {
      <div class="text-center py-5">
        <i class="bi bi-check-circle-fill text-success" style="font-size: 3rem;"></i>
        <p class="mt-3 text-muted">No tasks pending approval</p>
      </div>
      }
    </div>
  </div>
  }

  <!-- Overdue Tasks Tab -->
  @if (activeTab === 'Overdue Tasks') {
  <div class="card border-0 shadow-sm p-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h5 class="fw-bold mb-0"><i class="fas fa-exclamation-triangle text-danger"></i> Overdue Tasks</h5>
      <button class="btn btn-sm btn-outline-primary" (click)="loadOverdueTasks()">
        <i class="bi bi-arrow-clockwise"></i> Refresh
      </button>
    </div>

    <div class="list-group list-group-flush">
      @for (task of overdueTasks; track task.taskId) {
      @if (task.isOverdue) {
      <div class="card border-danger mb-3 p-3 shadow-sm" style="border-left: 4px solid #dc3545 !important;">
        <div class="d-flex justify-content-between align-items-start">
          <div class="flex-grow-1">
            <div class="d-flex align-items-center gap-2 mb-2">
              <i class="bi bi-exclamation-triangle-fill text-danger"></i>
              <h6 class="fw-bold mb-0">{{ task.title }}</h6>
              <span class="task-id-badge">Task #{{ task.taskId }}</span>
              <span class="badge bg-danger text-white">
                <i class="bi bi-clock"></i> OVERDUE
              </span>
            </div>
            <p class="small text-muted mb-2">{{ task.description }}</p>
            <div class="d-flex gap-2 mb-2">
              <span class="badge bg-info-subtle text-info">{{ task.assignedToUserName }}</span>
              <span class="badge" [ngClass]="{
                'bg-success': task.status === 'Approved',
                'bg-warning text-dark': task.status === 'Completed',
                'bg-primary': task.status === 'InProgress' || task.status === 'In Progress',
                'bg-secondary': task.status === 'Pending'
              }">{{ task.status }}</span>
              <span class="badge" [ngClass]="getPriorityClass(task.priority)">{{ task.priority }}</span>
            </div>
            <small class="text-danger">
              <i class="bi bi-calendar-x"></i> Due: {{ task.dueDate | date: 'MMM dd, yyyy' }}
              @if (task.daysUntilDue !== undefined && task.daysUntilDue < 0) {
              ({{ -task.daysUntilDue }} days overdue)
              }
            </small>
          </div>
          <div class="d-flex gap-2">
            <button class="btn btn-outline-primary btn-sm" (click)="openEditModal(task)">
              <i class="bi bi-pencil"></i> Update
            </button>
          </div>
        </div>
      </div>
      }
      }
      @empty {
      <div class="text-center py-5">
        <i class="bi bi-check-circle-fill text-success" style="font-size: 3rem;"></i>
        <p class="mt-3 text-muted">No overdue tasks</p>
      </div>
      }
    </div>
  </div>
  }

  <!-- Approved Tab -->
  @if (activeTab === 'Approved') {
  <div class="card border-0 shadow-sm p-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h5 class="fw-bold mb-0"><i class="fas fa-check-circle text-success"></i> Approved Tasks</h5>
      <button class="btn btn-sm btn-outline-primary" (click)="refreshTasks()">
        <i class="bi bi-arrow-clockwise"></i> Refresh
      </button>
    </div>

    <div class="list-group list-group-flush">
      @for (task of filteredTasks; track task.taskId) {
      @if (task.status === 'Approved') {
      <div class="card border-success mb-3 p-3 shadow-sm" style="border-left: 4px solid #22c55e !important;">
        <div class="d-flex justify-content-between align-items-start">
          <div class="flex-grow-1">
            <div class="d-flex align-items-center gap-2 mb-2">
              <i class="bi bi-check-circle-fill text-success"></i>
              <h6 class="fw-bold mb-0">{{ task.title }}</h6>
              <span class="task-id-badge">#{{ task.taskId }}</span>
              <span class="badge bg-success text-white">
                <i class="bi bi-check-circle"></i> Approved
              </span>
            </div>
            <p class="small text-muted mb-2">{{ task.description }}</p>
            <div class="d-flex gap-2 mb-2">
              <span class="badge bg-info-subtle text-info">{{ task.assignedToUserName }}</span>
              <span class="badge" [ngClass]="getPriorityClass(task.priority)">{{ task.priority }}</span>
              @if (task.completedDate) {
              <small class="text-muted">Completed: {{ task.completedDate | date: 'MMM dd, yyyy' }}</small>
              }
              @if (task.approvedDate) {
              <small class="text-success">Approved: {{ task.approvedDate | date: 'MMM dd, yyyy' }}</small>
              }
            </div>
            @if (task.estimatedHours && task.actualHours !== undefined) {
            <div class="mb-2">
              <small class="text-muted">Est: {{ task.estimatedHours }}h | Actual: {{ task.actualHours }}h</small>
              <div class="progress mt-1" style="height: 6px;">
                <div class="progress-bar bg-success" 
                  [style.width.%]="(task.actualHours / task.estimatedHours * 100 > 100 ? 100 : task.actualHours / task.estimatedHours * 100)">
                </div>
              </div>
            </div>
            }
            @if (task.approvedByUserName) {
            <small class="text-muted">
              <i class="bi bi-person-check"></i> Approved by: {{ task.approvedByUserName }}
            </small>
            }
          </div>
          <div class="d-flex gap-2">
            <button class="btn btn-outline-success btn-sm" (click)="openViewModal(task)">
              <i class="bi bi-eye"></i> View History
            </button>
          </div>
        </div>
      </div>
      }
      }
      @empty {
      <div class="text-center py-5">
        <i class="bi bi-check-circle text-muted" style="font-size: 3rem;"></i>
        <p class="mt-3 text-muted">No approved tasks yet</p>
      </div>
      }
    </div>
  </div>
  }
</div>

<!-- Create Task Modal -->
<div class="modal-backdrop fade show" *ngIf="showModal"></div>
<div class="modal fade show d-block" *ngIf="showModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg rounded-4 p-2">
      <div class="modal-header border-0 pb-0">
        <h5 class="fw-bold">New Task</h5>
        <button type="button" class="btn-close" (click)="showModal = false"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label class="form-label small text-muted">Task Title</label>
          <input type="text" class="form-control rounded-3" [(ngModel)]="newTask.title" placeholder="Enter task title">
        </div>
        <div class="mb-3">
          <label class="form-label small text-muted">Description</label>
          <textarea class="form-control rounded-3" [(ngModel)]="newTask.description" rows="3"></textarea>
        </div>
        <div class="mb-3">
          <label class="form-label small text-muted">Assign To</label>
          <select class="form-select rounded-3" [(ngModel)]="newTask.assignedTo">
            <option value="">Select Team Member</option>
            <option *ngFor="let member of teamMembers" [value]="member.userId">{{ member.name }}</option>
          </select>
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label small text-muted">Estimated Hours</label>
            <input type="number" class="form-control rounded-3" [(ngModel)]="newTask.hours" min="0" step="0.5">
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label small text-muted">Priority</label>
            <select class="form-select rounded-3" [(ngModel)]="newTask.priority">
              <option value="Low">Low</option>
              <option value="Medium">Medium</option>
              <option value="High">High</option>
            </select>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label small text-muted">Due Date</label>
            <input type="date" class="form-control rounded-3" [(ngModel)]="newTask.dueDate">
          </div>
        </div>
      </div>
      <div class="modal-footer border-0 pt-0">
        <button class="btn btn-light px-4" (click)="showModal = false" [disabled]="isSubmitting">Cancel</button>
        <button class="btn btn-primary px-4 fw-bold" (click)="addTask()" [disabled]="isSubmitting">
          @if (isSubmitting) {
            <span class="spinner-border spinner-border-sm me-2" role="status"></span>
            Creating...
          } @else {
            Create Task
          }
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Edit Task Modal -->
<div class="modal-backdrop fade show" *ngIf="showEditModal"></div>
<div class="modal fade show d-block" *ngIf="showEditModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg rounded-4 p-2">
      <div class="modal-header border-0 pb-0">
        <h5 class="fw-bold">Edit Task</h5>
        <button type="button" class="btn-close" (click)="closeEditModal()"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label class="form-label small text-muted">Task Title</label>
          <input type="text" class="form-control rounded-3" [(ngModel)]="editTask.title" placeholder="Enter task title">
        </div>
        <div class="mb-3">
          <label class="form-label small text-muted">Description</label>
          <textarea class="form-control rounded-3" [(ngModel)]="editTask.description" rows="3"></textarea>
        </div>
        <div class="mb-3">
          <label class="form-label small text-muted">Assign To</label>
          <select class="form-select rounded-3" [(ngModel)]="editTask.assignedTo">
            <option value="">Select Team Member</option>
            <option *ngFor="let member of teamMembers" [value]="member.userId">{{ member.name }}</option>
          </select>
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label small text-muted">Estimated Hours</label>
            <input type="number" class="form-control rounded-3" [(ngModel)]="editTask.hours" min="0" step="0.5">
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label small text-muted">Status</label>
            <select class="form-select rounded-3" [(ngModel)]="editTask.status">
              <option value="Pending">Pending</option>
              <option value="In Progress">In Progress</option>
              <option value="Completed">Completed</option>
            </select>
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label small text-muted">Priority</label>
            <select class="form-select rounded-3" [(ngModel)]="editTask.priority">
              <option value="Low">Low</option>
              <option value="Medium">Medium</option>
              <option value="High">High</option>
            </select>
          </div>
        </div>
        <div class="mb-3">
          <label class="form-label small text-muted">Due Date</label>
          <input type="date" class="form-control rounded-3" [(ngModel)]="editTask.dueDate">
        </div>
      </div>
      <div class="modal-footer border-0 pt-0">
        <button class="btn btn-light px-4" (click)="closeEditModal()" [disabled]="isSubmitting">Cancel</button>
        <button class="btn btn-primary px-4 fw-bold" (click)="saveEditTask()" [disabled]="isSubmitting">
          @if (isSubmitting) {
            <span class="spinner-border spinner-border-sm me-2" role="status"></span>
            Saving...
          } @else {
            Save Changes
          }
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Submission Approval Modal -->
<div class="modal-backdrop fade show" *ngIf="showApprovalModal && selectedSubmission"></div>
<div class="modal fade show d-block" *ngIf="showApprovalModal && selectedSubmission" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg rounded-4 p-2">
      <div class="modal-header border-0 pb-0">
        <h5 class="fw-bold">Review Task Submission</h5>
        <button type="button" class="btn-close" (click)="closeApprovalModal()"></button>
      </div>
      <div class="modal-body">
        <!-- Submission Details -->
        <div class="submission-details mb-4 p-3 bg-light rounded">
          <div class="detail-row mb-2">
            <strong>Employee:</strong>
            <span>{{ selectedSubmission.submittedBy }}</span>
          </div>
          <div class="detail-row mb-2">
            <strong>Task:</strong>
            <span>{{ selectedSubmission.taskTitle }} (#{{ selectedSubmission.taskId }})</span>
          </div>
          <div class="detail-row mb-2">
            <strong>Completion Status:</strong>
            <span [class]="'badge ' + getCompletionStatusClass(selectedSubmission.completionStatus)">
              {{ selectedSubmission.completionStatus }}
            </span>
          </div>
          <div class="detail-row mb-2">
            <strong>Hours Spent:</strong>
            <span>{{ selectedSubmission.hoursSpent }} hours</span>
          </div>
          <div class="detail-row">
            <strong>Comments:</strong>
            <p class="text-muted mb-0">{{ selectedSubmission.comments || 'No comments' }}</p>
          </div>
        </div>

        <!-- Approval Action -->
        <div class="approval-action mb-3">
          <label class="form-label small text-muted">Approval Action</label>
          <select [(ngModel)]="approvalForm.status" class="form-select rounded-3">
            <option value="Approved">Approve</option>
            <option value="Rejected">Reject</option>
            <option value="Need Changes">Request Changes</option>
          </select>
        </div>

        <!-- Conditional Reassign Date -->
        <div class="reassign-date mb-3" *ngIf="approvalForm.status === 'Approved'">
          <label class="form-label small text-muted">Reassign to Date (Optional)</label>
          <input type="date" [(ngModel)]="approvalForm.reassignDate" class="form-control rounded-3">
        </div>

        <!-- Comments -->
        <div class="approval-comments">
          <label class="form-label small text-muted">Your Comments</label>
          <textarea 
            [(ngModel)]="approvalForm.comments" 
            class="form-control rounded-3" 
            rows="3"
            [placeholder]="approvalForm.status === 'Rejected' ? 'Explain why you are rejecting...' : 'Add your feedback...'">
          </textarea>
        </div>
      </div>
      <div class="modal-footer border-0 pt-0">
        <button class="btn btn-light px-4" (click)="closeApprovalModal()">Cancel</button>
        <button 
          class="btn btn-warning px-4 fw-bold" 
          (click)="reassignTaskDate()"
          *ngIf="approvalForm.reassignDate && approvalForm.status === 'Approved'">
          <i class="fas fa-calendar"></i> Reassign Date
        </button>
        <button class="btn btn-primary px-4 fw-bold" (click)="processSubmission()">
          <i class="fas fa-check"></i> {{ approvalForm.status }}
        </button>
      </div>
    </div>
  </div>
</div>
<!-- Task History View Modal -->
<div class="modal-backdrop fade show" *ngIf="showViewModal"></div>
<div class="modal fade show d-block" *ngIf="showViewModal && viewTask" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content border-0 shadow-lg">
      <div class="modal-header bg-success text-white">
        <h5 class="fw-bold mb-0">
          <i class="bi bi-clock-history"></i> Task History - Task #{{ viewTask.taskId }}
        </h5>
        <button type="button" class="btn-close btn-close-white" (click)="closeViewModal()"></button>
      </div>
      <div class="modal-body p-4">
        <div class="card border-0 bg-light mb-3">
          <div class="card-body">
            <h6 class="fw-bold text-primary mb-3"><i class="bi bi-info-circle"></i> Task Information</h6>
            <div class="row g-3">
              <div class="col-md-6"><strong>Title:</strong> {{ viewTask.title }}</div>
              <div class="col-md-6"><strong>Status:</strong> <span class="badge bg-success ms-2">{{ viewTask.status }}</span></div>
              <div class="col-md-6"><strong>Assigned To:</strong> {{ viewTask.assignedToUserName }}</div>
              <div class="col-md-6"><strong>Estimated:</strong> {{ viewTask.estimatedHours }}h</div>
              <div class="col-md-12"><strong>Description:</strong> {{ viewTask.description }}</div>
            </div>
          </div>
        </div>

        <!-- Employee Work Descriptions -->
        <div class="card border-0 bg-light" *ngIf="viewTask.timeLogs && viewTask.timeLogs.length > 0">
          <div class="card-body">
            <h6 class="fw-bold text-success mb-3"><i class="bi bi-check-circle"></i> Employee Work Descriptions</h6>
            <div class="time-log-entry mb-3 pb-3 border-bottom" *ngFor="let log of viewTask.timeLogs; let last = last" [class.border-bottom]="!last">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <div>
                  <strong class="text-primary">{{ log.employeeName || 'Employee' }}</strong>
                  <small class="text-muted ms-2">{{ log.date | date:'medium' }}</small>
                </div>
                <span class="badge bg-info">{{ log.hoursSpent }}h</span>
              </div>
              <p class="mb-0 text-secondary">{{ log.workDescription }}</p>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeViewModal()">Close</button>
      </div>
    </div>
  </div>
</div>
